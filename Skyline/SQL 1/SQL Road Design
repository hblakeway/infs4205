-- To find out what type of road design has the most severe accidents in low visibility to analyse traffic behaviour.
-- Low visibility 0 - 2, Severity = 1 - 4

SELECT DISTINCT severity, visibility_mi, 
CASE WHEN amenity = TRUE  THEN 'amentity'
WHEN bump = TRUE THEN 'bump'
WHEN crossing = TRUE THEN 'crossing'
WHEN give_way = TRUE THEN 'give_way'
WHEN junction = TRUE THEN 'junction'
WHEN no_exit = TRUE THEN 'no_exit'
WHEN railway = TRUE THEN 'railway'
WHEN roundabout = TRUE THEN 'roundabout'
WHEN station = TRUE THEN 'station'
WHEN stop = TRUE THEN 'stop'
WHEN traffic_calming = TRUE THEN 'traffic_calming'
WHEN traffic_signal = TRUE THEN 'traffic_signal'
WHEN turning_loop = TRUE THEN'turning_loop'
ELSE 'No road design recorded.'
END AS road_design, COUNT(*) AS occurences
FROM trafficdata
WHERE severity = 4 AND visibility_mi = 0
AND (amenity = TRUE 
OR bump = TRUE OR crossing = TRUE OR give_way = TRUE OR junction = TRUE 
OR no_exit = TRUE OR railway = TRUE OR roundabout = TRUE OR station = TRUE 
OR stop = TRUE OR traffic_calming = TRUE OR traffic_signal = TRUE OR turning_loop = TRUE)
GROUP BY severity, visibility_mi, road_design
ORDER BY occurences DESC;

